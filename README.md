# RainWorld-Map
## So what is 'Rain World'?
Rain World is a *'survival platformer set in an abandoned industrial environment ravaged by a shattered ecosystem'*. And it is **awesome**.

If you love procedural animation, randomised gameplay, and relying on your instincts to survive in a rugged and hostile environment, Rain World is the game for you. Plus, it has a cute protagonist!

The game devs are James Primate and [Joar Jakobsson](http://joarportfolio.com/)

#### Links
- Discuss on the official [Devlog](http://forums.tigsource.com/index.php?topic=25183.0)
- See updates from the [Kickstarted campaign](https://www.kickstarter.com/projects/rain-world/project-rain-world) (for an abbreviated version of the DevLog)
- Add the [Steam store page](http://store.steampowered.com/app/312520) to your wishist
- Contribute to the [community wiki](http://rainworld.gamepedia.com/Rain_World_Wiki)

## View the map
The current map is available to view [here](http://tommilligan.github.io/RainWorld-Map). Please note this a dev version, and is low resolution. Corrections and suggestions are welcomed - please get in touch via the email address on my GitHub profile.

## Build your own map
__FAIR WARNING__
__This code is under *extremely* active development and will probably be re-written several times. Don't expect *anything* you do now to work for very long.__

### Installation
The following dependencies are required on Python 2 (tested v2.7.9). Several sub-dependencies are required, notably numpy. 
- Pillow (tested v2.8.1)
- networkx (tested v1.9.1)

This build was tested on Windows 7. Most packages can be installed with ```pip install```; where necessary, Windows installation binaries were used from [http://www.lfd.uci.edu/~gohlke/pythonlibs/]

### Generation
```generate.py``` is used to produce large ```.png``` images, by compiling screenshots, labels and other resources from the ```assets``` folder.
Several command line options can be specified - use the ```-h``` flag to learn more.
The network is generated using the ```networkx``` module to optimise connections listed in the ```network.db``` file.
Resulting images are placed in the ```big_image``` directory.
> If the resulting image is above 8192px, it will be split into several hq tiles of this size or smaller. ~~You can override this behaviour using the ```--force``` flag, but it may trigger ```MemmoryError``` exceptions or system instability.~~

```zoomify.py``` is used for images that are too large to be viewed under normal conditions. It takes images generated by ```generate.py``` and produces tiles and associated meta-data in the required directory structure for Zoomify compatibility (output is the ```zoomify_tiles``` directory).

These tiles can then be displayed by the open-source map viewer [Leaflet](http://leafletjs.com/), as a scroll- and zoom-able map. This requires the Leaflet-Zoomify plugin developed by [Bjørn Sandvik](http://blog.thematicmapping.org/2013/06/showing-zoomify-images-with-leaflet.html), and a suitable server on which to run Leaflet.
. View the ```gh-pages``` branch as an example.

### Assets
The ```assets``` directory stores screenshots and other files used during map creation.

- ```network.db``` stores regions, areas and nodes as uniquely keyed items.
Links between nodes are stored bidirectionally by key.
Node coordinates are in image-standard cartesian coordinates, i.e. y increases moving down the image. ```0,0``` is the centre of each area.
This exclusive and necessary bidirectional linkage can be checked by running ```verify.py```.
- ```areas``` contains the screenshots of each in game area
- ```labels``` contains the label masks used to indicate shelter rooms, swarm rooms etc.

## Todo List
- ~~Implement adaptive colour palette for "seamless" depending on region~~
    - ~~Generally improve colour palette system - maybe migrate to DB?~~
    - ~~Tidy up non-color palette properties, scale with image size~~
- ~~Look at circumnavigating size limit on image generation~~
    - ~~Partial image writing after position generation~~
        - ~~Only if over certain predicted size~~
        - ~~Adapt zoomify.py to handle multiple large slices~~
        - ~~Ensure slices written in easy-to-handle 256**n dimensions~~
    - ~~Fix bug during low res generation (think fixed?)~~
- ~~Store initial room in region db to enable easy seed generation~~
    - ~~Check for if this key stored is present in areas - if so, use, if not revert to asc order~~
- Make single script architecture
    - ~~Add command line options,~~ suppress verbosity for modular use
    - Tidy up formats and functionalise repeating motifs
    - ~~Change method of directory initialisation/removal to only used files~~
    - outsource region key lookup to common script (main, increment)
    - Change way in which tiles are moved after zoomification to prevent failure (correct mathematical lookup - see zoomify js script for Leaflet)
- Image design
    - ~~Add alpha channel options~~
        - ~~For icons: Make new RGBA object with variable mask and size and apply to objects <change_color()> function~~
        - ~~For lines: Make transparent around text; overlay semi-transparent rectangle underneath text to mask lines~~
    - ~~Correctly handle padding at edge of total image (i.e. do no use for coordinates)~~
- Website design
    - ~~map page~~
        - ~~add back button~~
        - ~~add title~~
        - ~~add links to other regions? <decided against>~~
    - add other regions

##### Good generation settings
- All regions generate fine with default: ```-k 3 -v 3 -i 50```
